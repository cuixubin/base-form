/** 当前路径 */var nowPath="/",nowFileId="",nowFile="",files,showFiles;$(function(){getFileList(nowPath)});function getFileList(a){$("#path_container").val(nowPath);var c=path+"/wzgl/template/template/list",b={};b.filePath=a;sw.showProcessBar();sw.ajaxSubmit(c,b,function(b){files=b;constructFiles();sw.hideProcessBar()})}function constructFiles(){search();showFiles.sort(orderBy);nowFile=nowFileId="";if("0"==$("#show_type").val()){var a;a='\x3ctable class\x3d"table"\x3e';for(var c=0;c<showFiles.length;c++){var b=showFiles[c];a+='\x3ctr id\x3d"file_'+c+'" title\x3d"'+b.full_name+'" file_full_name\x3d"'+b.full_name+'" file_name\x3d"'+b.name+'" class\x3d"list-'+("1"==b.is_dir?"folder":"image")+" file-single "+("1"==b.is_dir?"type-dir":"type-file")+'"\x3e';a+="\t\x3ctd\x3e"+("1"==b.is_dir?'\x3ci class\x3d"fa fa-folder-o"\x3e\x3c/i\x3e':'\x3ci class\x3d"fa fa-image"\x3e\x3c/i\x3e')+"\x26nbsp;\x26nbsp;"+b.full_name+"\x3c/td\x3e";a+="\t\x3ctd\x3e"+("1"==b.is_dir?"-":getFileSize(b.size))+"\x3c/td\x3e";a+="\t\x3ctd\x3e"+b.create_time+"\x3c/td\x3e";a+="\x3c/tr\x3e"}a+="\x3c/table\x3e"}else for(a="",c=0;c<showFiles.length;c++)b=showFiles[c],a+='\x3cdiv id\x3d"file_'+c+'" title\x3d"'+b.full_name+'" file_full_name\x3d"'+b.full_name+'" file_name\x3d"'+b.name+'" class\x3d"file file-single '+("1"==b.is_dir?"type-dir":"type-file")+'"\x3e',a+='\t\x3cdiv class\x3d"thumbnail"\x3e',a+='\t\t\x3cdiv class\x3d"caption"\x3e',a="1"==b.is_dir?a+'\t\t\t\x3ch3\x3e\x3ci class\x3d"fa fa-folder-o"\x3e\x3c/i\x3e\x3c/h3\x3e':a+'\t\t\t\x3ch3\x3e\x3ci class\x3d"fa fa-file-o"\x3e\x3c/i\x3e\x3c/h3\x3e',a+="\t\t\t\x3cp\x3e"+b.full_name+"\x3c/p\x3e",a+="\t\t\x3c/div\x3e",a+="\t\x3c/div\x3e",a+="\x3c/div\x3e";$("#show_files_container").html(a);bindMethod()}function bindMethod(){$(".file-single").mouseover(function(){$(this).addClass("file-single-hover")}).mouseout(function(){$(this).removeClass("file-single-hover")});$(".file-single").click(function(){$(".file-single").removeClass("file-single-select");$(this).addClass("file-single-select");nowFileId=this.id.split("_")[1];nowFile=$(this).attr("file_full_name");$("#file_name").val($(this).attr("file_name"))});$(".type-dir").dblclick(function(){nowPath+=$(this).attr("file_full_name")+"/";uploaderParams.nowPath=nowPath;uploader.setPostParams(uploaderParams);getFileList(nowPath)});"1"==isSelect&&$(".type-file").dblclick(function(){var a=previewPath+nowPath+$(this).attr("file_full_name");sw.getTopWindow(window).model_args.selectFileReturnValue=a;parent.sw.closeWindow("self")})}function goBack(){"/"!=nowPath&&(nowPath=nowPath.substr(0,nowPath.length-1),nowPath=nowPath.substr(0,nowPath.lastIndexOf("/"))+"/",uploaderParams.nowPath=nowPath,uploader.setPostParams(uploaderParams),getFileList(nowPath))}function refresh(){getFileList(nowPath)}function fakeRefresh(){constructFiles()}function search(){showFiles=[];var a=$("#search_content").val();if(""!=a)for(var c=0;c<files.length;c++){var b=files[c];-1!=b.full_name.indexOf(a)&&showFiles.push(b)}else showFiles=files}function orderBy(a,c){var b=$("#order").val(),e=$("#order_type").val(),d=0;"0"==b&&(d="1"==a.is_dir&&"0"==c.is_dir?-1:"0"==a.is_dir&&"1"==c.is_dir?1:a.name.localeCompare(c.name));"1"==b&&(d=a.size-c.size);"2"==b&&(d=a.create_time_long-c.create_time_long);"1"==e&&(d*=-1);return d}function addFolder(){var a=path+"/wzgl/template/template/add",c={};c.nowPath=nowPath;c.fileName=$("#file_name").val();sw.showProcessBar();sw.ajaxSubmit(a,c,function(b){if("0"==b.success)sw.toast(b.message,"warning",3E3);else{var a={};a.name=b.name;a.full_name=b.full_name;a.extension=b.extension;a.is_dir=b.is_dir;a.size=b.size;a.create_time_long=b.create_time_long;a.create_time=b.create_time;files.push(a);fakeRefresh();sw.toast(b.message,"success",3E3)}sw.hideProcessBar()})}function modifyFileName(){if(""==nowFileId)sw.toast("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u547d\u540d\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939\uff01","warning",3E3);else{var a=path+"/wzgl/template/template/rename",c={};c.nowPath=nowPath;c.nowFile=nowFile;c.fileName=$("#file_name").val();sw.showProcessBar();sw.ajaxSubmit(a,c,function(b){if("0"==b.success)sw.toast(b.message,"warning",3E3);else{var a={};a.name=b.name;a.full_name=b.full_name;a.extension=b.extension;a.is_dir=b.is_dir;a.size=b.size;a.create_time_long=b.create_time_long;a.create_time=b.create_time;files.splice(nowFileId,1,a);fakeRefresh();sw.toast(b.message,"success",3E3)}sw.hideProcessBar()})}}function deleteFile(){if(""==nowFileId)sw.toast("\u8bf7\u9009\u62e9\u9700\u8981\u5220\u9664\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939\uff01","warning",3E3);else if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u6b64\u6587\u4ef6\u5417\uff1f")){var a=path+"/wzgl/template/template/delete",c={};c.nowPath=nowPath;c.nowFile=nowFile;sw.showProcessBar();sw.ajaxSubmit(a,c,function(a){"0"==a.success?sw.toast(a.message,"warning",3E3):(files.splice(nowFileId,1),fakeRefresh(),sw.toast(a.message,"success",3E3));sw.hideProcessBar()})}}var modalCallback;function selectFile(){if($(".file-single-select").hasClass("type-dir"))sw.toast("\u60a8\u4e0d\u80fd\u9009\u62e9\u6587\u4ef6\u5939\uff0c\u8bf7\u9009\u62e9\u6587\u4ef6\u3002","warning",3E3);else{var a=$(".file-single-select").attr("file_full_name");modalCallback(a);closeModal("selectFile",parent)}}function clearFile(){modalCallback("");closeModal("selectFile",parent)};